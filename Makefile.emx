LIBNAME = opus.a

CC     = gcc
AR     = ar
RANLIB = ranlib

#FIXED_POINT=1
#USE_ENCODER=1

CFLAGS = -Zmt -O2 -Wall
CPPFLAGS = -DOPUS_BUILD -DOPUS_STATIC -DUSE_ALLOCA -DHAVE_ALLOCA_H
#CPPFLAGS+= -DCUSTOM_MODES
#CPPFLAGS+= -DENABLE_ASSERTIONS
INCLUDES = -Iinclude -Isilk -Icelt
ARFLAGS  = cru

ifeq ($(FIXED_POINT),1)
CPPFLAGS+= -DFIXED_POINT=1 -DDISABLE_FLOAT_API
INCLUDES+= -Isilk/fixed
else
INCLUDES+= -Isilk/float
endif

include silk_sources.mk
include celt_sources.mk
include opus_sources.mk

ifeq ($(USE_ENCODER),1)
CPPFLAGS+= -DOPUS_ENABLE_ENCODER
CELT_SOURCES+= $(CELT_SOURCES_ENC)
SILK_SOURCES+= $(SILK_SOURCES_ENC)
OPUS_SOURCES+= $(OPUS_SOURCES_ENC)
ifeq ($(FIXED_POINT),1)
SILK_SOURCES+= $(SILK_OBJS_FIXED)
else
SILK_SOURCES+= $(SILK_OBJS_FLOAT)
OPUS_SOURCES+= $(OPUS_OBJS_FLOAT)
endif
endif
SRCS = $(SILK_SOURCES) $(CELT_SOURCES) $(OPUS_SOURCES)
OBJS = $(patsubst %.c,%.o,$(SRCS))

all: $(LIBNAME)

%.o: %.c
	$(CC) $(CFLAGS) $(CPPFLAGS) $(INCLUDES) -c $< -o $@

celt/celt.o: CPPFLAGS += -DPACKAGE_VERSION=\"1.0.3\"

$(LIBNAME): $(OBJS)
	$(AR) $(ARFLAGS) $@ $^
	$(RANLIB) $@
